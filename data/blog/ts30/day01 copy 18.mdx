---
title: 'éµäººè³½Day01: ç‚ºä»€éº¼æˆ‘æƒ³è¦å­¸ TypeScript'
date: 2021-10-11
tags: ['ts30', 'tech']
draft: false
summary: é€™æ˜¯ä¸€ç¯‡æ¬ äº†å¾ˆä¹…çš„é–‹å ´ï¼Œå¤§æ¦‚è½‰è¡Œä¸åˆ°1å¹´çš„æ™‚å€™ï¼Œå°±ä¸€ç›´è½åˆ° TypeScript çš„åå­—ï¼Œæƒ³èªªåˆ°åº•æ˜¯å•¥
images: ['']
authors: ['chick_playground']
---

# Day18: ã€TypeScript å­¸èµ·ä¾†ã€‘Narrowing Part 2

> å¥½ ç¹¼çºŒä¾†ç­†è¨˜ Narrowingï¼Œ é‚„æœ‰å“ªäº›æ–¹æ³•èƒ½é€²è¡Œ narrow å‹åˆ¥å‘¢ã€‚ è‹¥æœ‰éŒ¯èª¤ï¼Œæ­¡è¿ç•™è¨€æŒ‡æ•™ï¼Œæ„Ÿæ©çš„å¿ƒã€‚

---

## ä½¿ç”¨ type predicatesï¼ˆå‹åˆ¥è¬‚èªï¼‰

- å¦‚æœæˆ‘å€‘è¦è‡ªå®šç¾©type guardï¼Œå¯ä»¥å®šç¾©ä¸€å€‹å‡½å¼ï¼Œé€™å€‹å‡½å¼è¿”å›çš„å€¼å°±æ˜¯ type predicatesã€‚
- type predicate æŒ‡çš„å°±æ˜¯ `parameterName is Type`ã€‚ä»¥ä¸‹æ–¹ä¾‹å­ï¼Œ `pet is Fish` å°±æ˜¯ type predicateã€‚
- `parameterName` å¿…é ˆè¦æ˜¯å‡½å¼ä¸­åƒæ•¸çš„åç¨±ï¼Œä¸‹æ–¹ä¾‹å­çš„çš„åƒæ•¸åç¨±å°±æ˜¯ `pet` , æ‰€ä»¥ `parameterName` å°±æœƒæ˜¯ `pet`ã€‚
- å‡½å¼æœ€å¾Œæœƒå›å‚³ true æˆ– falseï¼Œå¦‚æœæ˜¯ trueï¼Œè¡¨ç¤ºç¬¦åˆè©²è®Šæ•¸ç¬¦åˆè©² type predicateã€‚

```javascript=
type Fish = { swim: () => void };
type Bird = { fly: () => void };

//pet æœ‰å¯èƒ½æ˜¯ Fish or Bird çš„å‹åˆ¥
//isFish é€™å€‹function å›å‚³å€¼çš„å‹åˆ¥ç‚º : pet is Fishï¼Œçœ‹æ˜¯å›å‚³ true or false
//ç•¶è¿”å›äº†true, é‚£ä»–å°±æ˜¯Fish

function isFish(pet: Fish | Bird): pet is Fish {
  return (pet as Fish).swim !== undefined;   //ï¼ˆpet as Fishï¼‰æ–·è¨€ pet ç‚º Fish å‹åˆ¥ ï¼Œ æ‰€ä»¥ swim ä¸æœƒæ˜¯undefined
}
```

---

## Discriminated unions ï¼ˆå¯è¾¨è­˜è¯åˆï¼‰

TypeScript å¯ä»¥é‡å°ç›¸åŒçš„å¯è­˜åˆ¥çš„å±¬æ€§ä¾†è‡ªå‹•åˆ¤æ–·å‹åˆ¥ï¼Œå†å»åŸ·è¡Œä¸åŒæƒ…å¢ƒçš„æ“ä½œï¼Œä»–æœ‰3å€‹è¦ç´ ï¼š

1. æ¯å€‹interfaceéœ€è¦æœ‰ç›¸åŒçš„å¯è¾¨è­˜çš„å±¬æ€§ï¼Œå¦‚ `kind`
2. ä½¿ç”¨type aliaså®£å‘Šè¯åˆå‹åˆ¥ï¼Œä»–åŒ…å«äº†å“ªäº›å‹åˆ¥ï¼Œ å¦‚ `type Shape = Circle | Square;`
3. ä½¿ç”¨ type guardï¼Œ å¦‚` shape.kind === "circle"`

```typescript=

interface Circle {
  kind: "circle";
  radius: number;
}

interface Square {
  kind: "square";
  sideLength: number;
}

type Shape = Circle | Square;

function getArea(shape: Shape) {
  if (shape.kind === "circle") {
    return Math.PI * shape.radius ** 2;
  }
}

let area = getArea({ kind: "circle", radius: 5});
console.log(area);
```

### å¯ç”¨åœ¨å¾Œç«¯å›å‚³ response

çœ‹ pj å¤§å¤§çš„æ–‡ç« æ˜¯æ¨è–¦åœ¨æ¥æ”¶å¾Œç«¯å‚³ä¾†çš„ response çš„æ™‚å€™å¾ˆå¥½ç”¨ï¼Œ status æ˜¯ OK çš„è©±ï¼Œå‰‡è³‡æ–™æœƒå¸¶æœ‰ payloadï¼Œå¦å‰‡è³‡æ–™æœƒå¸¶æœ‰ errorã€‚æˆ‘å€‘å¯ä»¥è‡ªè¡Œå®šç¾©å¤šå€‹ä¸åŒçš„ Typeï¼Œé€™äº›Typeæœ‰å…±åŒçš„æ¬„ä½ï¼Œ å¦‚ `status`ï¼Œé‚£å°±ç”¨é€™å€‹æ¬„ä½ä¾†åˆ¤æ–·é‚„æœ‰å“ªäº›å±¬æ€§ã€‚

æœ€å¾Œæ²’æœ‰åˆ¤æ–·åˆ°çš„æƒ…æ³å¯ä»¥åˆ©ç”¨ exhaustiveness checkingï¼Œ ç”¨`never`å‹åˆ¥è¡¨ç¤ºä¸æ‡‰è©²å­˜åœ¨çš„ç‹€æ…‹ï¼Œä¸€èˆ¬ç”¨æ–¼éŒ¯èª¤è™•ç†ã€‚

```javascript=
interface ISuccessResp {
  status: 'OK';  //ç›¸åŒæ¬„ä½ status
  payload: unknown;
}

interface IErrorResp {
  status: 'ERROR';
  errorCode: number;
  description: string;
}

type Resp = ISuccessResp | IErrorResp;

const parseResponse = (resp: Resp) => {
  switch (resp.status) {
    case 'OK':  //é€é narrow çŸ¥é“æ˜¯ ISuccessResp å‹åˆ¥
      return resp.payload; //å‰‡å»ä½¿ç”¨ISuccessRespçš„å±¬æ€§payload
    case 'ERROR': // é€é narrow çŸ¥é“æ˜¯ IErrorResp å‹åˆ¥
      return resp.description; //å‰‡å»ä½¿ç”¨IErrorRespçš„å±¬æ€§payload
    default:
      const _exhaustiveCheck: never = resp;
      return _exhaustiveCheck;
  }
};
```

---

> é€™å…©å¤©è·‘å‡ºå»ç©ï¼Œå¹«å¥½ä¹…ä¸è¦‹çš„æœ‹å‹æ…¶ç”Ÿï¼Œä¹…é•çš„é–‹å¿ƒXD (å¥½å¤šå¥½æœ‹å‹éƒ½æ˜¯10æœˆç”Ÿæ—¥ï¼Œ ç”Ÿæ—¥å¿«æ¨‚å‘€ï¼Œ å¤©ç§¤å¯¶å¯¶å€‘
> ä¸éå›åˆ°å®¶ï¼Œçœ‹åˆ°æ–‡ç« åº«å­˜ä¸€å¤©ä¸€å¤©ç”¨å®Œï¼Œè¦ºå¾—å¥½å¯æ€•ï¼Œå¥½å§ï¼Œ æ˜å¤©åˆæ˜¯ç¦®æ‹œä¸€äº†ï¼Œä¸€èµ·åŠ æ²¹ ğŸ’ª

---

## åƒè€ƒè³‡æ–™

https://pjchender.dev/typescript/ts-narrowing/#user-defined-type-guards
https://www.typescriptlang.org/docs/handbook/2/narrowing.html
https://ithelp.ithome.com.tw/articles/10222470
https://blog.csdn.net/weixin_34088583/article/details/92693893
https://zh.wikipedia.org/wiki/%E6%A0%87%E7%AD%BE%E8%81%94%E5%90%88
